<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>تحديد الموقع والمصدر ونوع الجهاز</title>
  <style>
    body {
      font-family: Arial;
      direction: rtl;
      padding: 20px;
      background: #f0f0f0;
    }
    h1 { color: #007bff; }
    .info {
      background: white;
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
      box-shadow: 0 0 5px #ccc;
    }
  </style>
</head>
<body>
  <h1>معلوماتك:</h1>

  <div class="info" id="location">جاري تحديد الموقع...</div>
  <div class="info" id="device">جاري تحديد نوع الجهاز...</div>
  <div class="info" id="source">جاري تحديد مصدر دخولك...</div>

  <script>
    // 1. الموقع الجغرافي
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async position => {
        const { latitude, longitude } = position.coords;
        // API مجاني للحصول على العنوان بدقة
        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`);
        const data = await response.json();
        const address = data.address;

        let locationText = `أنت في: `;
        if (address.country) locationText += address.country + '، ';
        if (address.state) locationText += address.state + '، ';
        if (address.city || address.town || address.village) locationText += (address.city || address.town || address.village) + '، ';
        if (address.road) locationText += `شارع ${address.road}`;
        document.getElementById("location").textContent = locationText;
      }, () => {
        document.getElementById("location").textContent = "تعذر تحديد الموقع.";
      });
    } else {
      document.getElementById("location").textContent = "المتصفح لا يدعم تحديد الموقع.";
    }

    // 2. نوع الجهاز
    const ua = navigator.userAgent;
    let deviceInfo = "نوع الجهاز غير معروف";

    if (/Android/i.test(ua)) {
      if (/Samsung|SM-|Galaxy/i.test(ua)) deviceInfo = "جهاز Samsung (أندرويد)";
      else if (/OPPO|CPH/i.test(ua)) deviceInfo = "جهاز OPPO (أندرويد)";
      else deviceInfo = "جهاز Android";
    } else if (/iPhone|iPad|iPod/i.test(ua)) {
      deviceInfo = "جهاز Apple (iOS)";
    } else if (/Windows/i.test(ua)) {
      deviceInfo = "جهاز كمبيوتر (Windows)";
    } else if (/Mac/i.test(ua)) {
      deviceInfo = "جهاز Mac";
    }

    document.getElementById("device").textContent = deviceInfo;

    // 3. مصدر الدخول (referrer أو المعرف الذكي في الرابط)
    const params = new URLSearchParams(window.location.search);
    let source = "غير معروف";

    if (params.has('source')) {
      source = params.get('source');
    } else {
      const ref = document.referrer;
      if (ref.includes("facebook.com")) source = "فيسبوك";
      else if (ref.includes("instagram.com")) source = "إنستجرام";
      else if (ref.includes("t.me")) source = "تيليجرام";
      else if (ref.includes("whatsapp.com")) source = "واتساب";
      else if (ref) source = `من: ${ref}`;
      else source = "دخول مباشر أو غير معروف";
    }

    document.getElementById("source").textContent = "مصدر دخولك: " + source;
  </script>
</body>
</html>
